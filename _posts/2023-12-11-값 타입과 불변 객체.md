---
title: 값 타입과 불변 객체
aliases: 
tags:
  - jpa
  - java
categories:
  - jpa
toc: true
toc_label: 목차
date: 2023-12-11
last_modified_at: 2024-01-25
---
값 타입은 복잡한 객체 세상을 조금이라도 단순화 하려고 만든 개념이다.
따라서 값 타입은 단순하고 안전하게 다룰 수 있어야 한다.

값 타입 공유 참조
- 임베디드 타입같은 값 타입을 여러 엔티티에서 공유하면 위험함.
- side effect 발생 가능

![](https://i.imgur.com/sCkjZcg.png)

![](https://i.imgur.com/PLrt1wz.png)

![](https://i.imgur.com/CVUVrI1.png)


##### 객체 타입의 한계
- 항상 값을 복사해서 사용하면 공유 참조로 인해 발생하는 부작용을 피할 수 있다.
- 문제는 임베디드 타입처럼 **직접 정의한 값 타입은 자바의 기본 타입이 아니라 객체 타입** 이다.
- 자바 기본 타입에 값을 대입하면 값을 복사한다.
- **객체 타입은 참조 값을 직접 대입하는 것을 막을 방법이 없다.**
- **객체의 공유 참조는 피할 수 없다.**

![](https://i.imgur.com/qStXguJ.png)


#### 불변 객체
- 객체 타입을 수정할 수 없게 만들면 **부작용을 원천 차단**
- **값 타입은 불변 객체(immutable object) 로 설계해야함.**
- **불변객체 : 생성 시점 이후 절대 값을 변경할 수 없는 객체**
- 생성자로만 값을 설정하고 (Setter)를 만들지 않으면 됨
- 참고 : Integer, String 은 자바가 제공하는 대표적인 불변 객체

---
# 값 타입의 비교

값 타입 : 인스턴스가 달라도 그 안에 값이 같으면 같은 것으로 봐야함

![](https://i.imgur.com/4CZDDg9.png)


- **동일성(identity) 비교 :** 인스턴스의 참조 값을 비교, == 사용
- **동등성(equivalence) 비교 :** 인스턴스의 값을 비교, equals() 사용
- 값 타입은 a.equlas(b) 를 사용해서 동등성 비교를 해야함
- 값 타입의 equals 메소드를 적절하게 재정의 (주로 모든 필드 사용)

